<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>
      Groovy初接触 | 
      DouO's Blog
    </title>
    <meta name="author" content="DouO">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
    
    <!-- Le styles -->
<link href='/moon-2013/assets/stylesheets/bootstrap.min-93b47f97c3444c4711853ed5140d82a1.css' type='text/css' rel='stylesheet' media='all'>
<link href='/moon-2013/assets/stylesheets/bootstrap-responsive.min-6be942c8ec424a44aa4f31e099bae1fc.css' type='text/css' rel='stylesheet' media='all'>
<link href='/moon-2013/assets/stylesheets/toc-24de7073de5e84bbdf82d581655967fa.css' type='text/css' rel='stylesheet' media='all'>
<link href='/moon-2013/assets/stylesheets/style-2a78e0c366d18704c93f8db7772659c6.css' type='text/css' rel='stylesheet' media='all'>
<link href='/moon-2013/assets/stylesheets/widgets/google_prettify/moon-a586c0c53856bb03a2050ca5121629fe.css' type='text/css' rel='stylesheet' media='all'>    

    <!-- script -->
<script src='/moon-2013/assets/javascripts/jquery-1.8.2.min-cfa9051cc0b05eb519f1e16b2a6645d7.js'></script>
<script src='/moon-2013/assets/javascripts/bootstrap.min-240e44e4195f0836ced0eab636f9cb0c.js'></script>
<script src='/moon-2013/assets/javascripts/front-9bcae9460ba6dd25c936b7bdc47a9998.js'></script>
<script src='/moon-2013/assets/javascripts/jquery.c.min-e08fd6c1881afcf509255ce8b8f9b32b.js'></script>
<script src='/moon-2013/assets/javascripts/jquery.smooth-scroll.min-5caac1be39aee89977e39f82d14f0e08.js'></script>    
    
	

<script src="/moon-2013/assets/widgets/lazyload/javascripts/jquery.lazyload.min.js"></script>
    <!-- lazyload -->
    <script type="text/javascript">
      jQuery(document).ready(function($){
      if (navigator.platform == "iPad") return;
      jQuery("img.lazy").not(".cycle img").lazyload({
      effect:"fadeIn",
      placeholder: "/moon-2013/assets/media/ajax-loader.gif"
      });
      });
    </script>
   

    
<!-- Add mousewheel plugin (this is optional) -->
<script type="text/javascript" src="//cdn.staticfile.org/jquery-mousewheel/3.1.3/jquery.mousewheel.min.js"></script>


<!-- Add fancyBox -->
<link rel="stylesheet" href="/moon-2013/assets/widgets/fancybox/stylesheets/jquery.fancybox.css" type="text/css" media="screen" />
<script src="/moon-2013/assets/widgets/fancybox/javascripts/jquery.fancybox.pack.js"></script>

<!-- Optionally add helpers - button, thumbnail and/or media -->

<!-- <link rel="stylesheet" href="/fancybox/source/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen" />
<script type="text/javascript" src="/fancybox/source/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="/fancybox/source/helpers/jquery.fancybox-media.js?v=1.0.6"></script>

<link rel="stylesheet" href="/fancybox/source/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen" />
<script type="text/javascript" src="/fancybox/source/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script> -->


<script type="text/javascript">
      $(document).ready(function() {
      $(".fancybox").fancybox();
      });
    </script>
   


    <link rel="shortcut icon" href="/moon-2013/assets/media/favicon.ico">
    <!-- Le fav and touch icons -->
    <!-- Update these with your own images
	 <link rel="shortcut icon" href="images/favicon.ico">
	 <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	 <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	 <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	 -->
    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12243999-3']);
  _gaq.push(['_trackPageview']);
  

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


    <!-- processing -->
    
<script type="text/javascript"
  src="http://cdn.staticfile.org/processing.js/1.4.1/processing.min.js">
</script>

  </head>
  <body>
    <div class="container">
      <div class="row-fluid">
	<div class="span2 hidden-phone"></div>
	<div class="span8">
	  <header class="header pull-left">
	    <h1>Groovy初接触</h1>
	  </header>
  	  <button type="button" class="btn btn-navbar pull-right" data-toggle="collapse" data-target=".nav-collapse">
	    <span class="icon-bar"></span>
	    <span class="icon-bar"></span>
	    <span class="icon-bar"></span>
	    </button>
	</div> <!-- header -->

         </div>
      <div class="row-fluid">
	<div class="span2 hidden-phone"></div>
	<div class="span8 content">
	  <div class="nav-wrapper nav-collapse collapse"   data-spy="affix" data-offset-top="70" >
	    <nav class="nav moon-nav-list">
	      <ul>
	        <li><a href="/" rel="tooltip" data-placement="top" title="主頁">home</a></li>
	        <li><a href="/archives" rel="tooltip" data-placement="top" title="文章歸檔">archives</a></li>
	        <li><a href="/notes" rel="tooltip" data-placement="top" title="我的個人筆記">notes</a></li>
	        <li><a href="/rss.xml" rel="tooltip" data-placement="top" title="訂閱">feed</a></li>
	        <li><a href="/about" rel="tooltip" data-placement="top" title="關於我">about</a></li>
	        <li  class="separate"></li>
	        <li> 
	  	<a class="meta-nav next" href="/moon-2013/2011/05/09/im-back">
	  	  <span>←<br></span>I'm Back!
	  	</a>
	        </li>
	        <li>
	  	<a class="meta-nav previous" href="/moon-2013/2010/12/09/dokuwiki-new-realease">
	  	  dokuwiki新版本&quot;Anteater&quot;支持UTF-8文件名<span><br>→</span>
	  	</a>
	        </li>
	      </ul>
	    </nav>
	  </div>
	  
	      <article class="post box">
<ul class="category-label">
<li><a href="/moon-2013/categories#coder-ref" class="coder">coder</a></li>
</ul>
<div class="cf"></div>


<h3 id="toc_0">Groovy</h3>
<p>Groovy是一种运行在Java虚拟机上的脚本语言，语法相比java起来简单很多。而且完全支持Java语法，这个不知道是不是好事，写习惯groovy再去写java会不会很容易混淆？所有Java的库都可以在Groovy上使用，可以说跟Java是互通的。Groovy的就是一跑在jvm上的脚本语言嘛，Groovy的代码最后也要被编译成为jvm上的字节码。</p>

<p>一直都打算学一种脚本语言来写脚本和小程序的，本来是用python的，用了几天，一放松又用回Java了。Java虽然库比较熟悉，代码比较亲切，但是用来写脚本还是太繁琐了。接触都Groovy后，感觉就是它了，有脚本语言的语法和Java的库，对于会Java的人来说，学习Groovy几乎是零成本的！</p>

<p>官网:<a href="http://groovy.codehaus.org" title="">http://groovy.codehaus.org</a>
（二级域名...orz） 装Groovy前要先安装好Java环境。 Groovy的环境配置：</p>

<p>文档方面:英文的该有还是有的.中文的就比较稀少了.
netbeans下有个Groovy插件挺好用的，在同一个项目里Groovy文件可以跟java文件混用</p>

<p>groovy没有强制分号
groovy也没像python那样的强制缩进.还是得用花括号，这个比较可惜。</p>

<p>Groovy 默认导入了下面这些包</p>

<p>java.io.*</p>

<p>java.lang.*</p>

<p>java.math.BigDecimal</p>

<p>java.math.BigInteger</p>

<p>java.net.*</p>

<p>java.util.*</p>

<p>groovy.lang.*</p>

<p>groovy.util.*</p>

<p>「==」操作符，不再比较引用，如下面的的代码输出2个true</p>
<pre><code class="groovy">a = new String(&quot;wtf&quot;)
b = new String(&quot;wtf&quot;)
println a == b
println a.equals(b)
</code></pre>
<p><code>Output:true
true
</code>
正则表达式也有独立的操作符，正则表达式要用两个斜杠包围起来。 是否匹配
==~ 如 <code>println &quot;potatoe&quot; ==~ /potatoe/</code> <code>Output:true</code> 匹配结果 =~\
会返回一个相当于java.util.regex.Matcher的对象。</p>
<h3 id="toc_1">闭包(Closure)</h3>
<p>用python的时候还没用过闭包，毕竟是没接触过的特性所以有股阻力，Lisp则是想学还没动手，所以学Groovy也算是我第一次接触闭包了。</p>

<p>闭包就像这样 <code>s = {println it}</code> 一个变量名 指向一个代码块 调用s(5)
就会打印出 5 官方帮助的例子是</p>
<pre><code class="groovy">square = { it * it}

println square(9)
</code></pre>
<p><code>Output:81</code></p>

<p>闭包也可以当成方法的参数去传递； 如 <code>[ 1, 2, 3, 4 ].collect(square)</code>
闭包在java成面就是groovy.util.Closure这个类，
所以可以这样传递还可以理解。 关于闭包的参数；
默认一个参数就是it，可以不用声明直接用便可。
多于一个参数可以用下面这种方式来指定参数列表 <code>closure = {a,b,...n -&gt;  code}
closure(a,b,...n)</code>
还可以匿名<code>[ &quot;yue&quot; : &quot;wu&quot;, &quot;lane&quot; : &quot;burks&quot;, &quot;sudha&quot; : &quot;saseethiaseeleethialeselan&quot; ].each(
{
key, value -&gt; println key + &quot;=&quot; + value
})</code> 闭包匿名的时候可以省略括号
<code>[ &quot;yue&quot; : &quot;wu&quot;, &quot;lane&quot; : &quot;burks&quot;, &quot;sudha&quot; : &quot;saseethiaseeleethialeselan&quot; ].each
{
key, value -&gt; println key + &quot;=&quot; + value
}</code></p>

<p>还可以这样写 </p>
<pre><code class="groovy">n = 5;
({
for(int i in 1..100)
println i*n
}).call()
</code></pre>
<p>闭包内部可以调用其外部的变量
这个如何实现的也很好奇啊 在官网上的例子还看过这么一个用法</p>
<pre><code class="groovy">def groovyImage = new GroovyImage();
def argAndClosure = ['-d':{groovyImage.srcDir = new File(it)},
'-q':{groovyImage.outputPattern = it},
'-p':{groovyImage.pattern = it},
'-h':{groovyImage.help()}];
</code></pre>
<p>闭包当成Map的Value，直接Map[key].call()果然很方便。</p>

<p>看了一天目前知道的差不多就这些，刚接触闭包，概念还待慢慢理解；Groovy其他的特点还待慢慢发掘。</p>
<h3 id="toc_2">Groovy的效率</h3>
<p>最后再看看Groovy的效率如何，分别在Java、Python、Groovy上写了个生成素数表的方法，代码几乎一致。
Java： </p>
<pre><code class="java">/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

package org.dou.euler;

import java.util.ArrayList;

/**
 *
 * @author DouO
 */
public class Prime {
 public static ArrayList&lt;Long&gt; primes = new ArrayList&lt;Long&gt;(100);
    public static void buildPrimeTable(int n){
        primes.add(2L);
        primes.add(3L);
        int k = 2;
        long s = 5;
        for (int i = 0; i &lt; n-2; i++) {
            int j = 0;
            int q = (int) Math.ceil(Math.sqrt(s));;
            while (j &lt; i ) {
                if (primes.get(j)&lt;=q&amp;&amp;s % primes.get(j) == 0) {
                     s+=k;
                     k = (k+k)%6;
                     q = (int) Math.ceil(Math.sqrt(s));
                      j = 0;
                } else {
                    j++;
                }
            }
            j = 0;
            primes.add(s);
            s+=k;
            k = (k+k)%6;
            q = (int) Math.ceil(Math.sqrt(s));
        }
    }
    public static void main(String[] args) {
        long t = System.currentTimeMillis();
        buildPrimeTable(10001);
        System.out.println(System.currentTimeMillis() - t);
        System.out.println(primes.get(10000));
    }
}
</code></pre>
<p>Python: </p>
<pre><code class="python">import math
import time
primes = []
def buildTable(n):
#    if(len(primes)&lt;=0):
#        primes.append(2)
#        sindex = 1;
#    else:
#        sindex = len(primes+1);
    primes.append(2)
    primes.append(3)
    s = 5
    k = 2
    for i in range(0,n):
        j=0
        q = int(math.sqrt(s)+0.5)
        while(j&lt;i):
            if(primes[j]&lt;=q and s%primes[j]==0):
                s+=k
                k=(k+k)%6
                q = int(math.sqrt(s)+0.5)
                j=0
            else:
                j+=1
        primes.append(s)
        s+=k
        k=(k+k)%6
        q = int(math.sqrt(s)+0.5)

time.clock()
buildTable(10000)
print primes[10000]
print time.clock()
</code></pre>
<p>Groovy:</p>
<pre><code class="groovy">primes = []
def buildPrimeTable(n){
    primes.add(2)
    primes.add(3)
    s = 5
    k = 2
    for(i in 0..n-2){
        j = 0
        q = (int) Math.ceil(Math.sqrt(s))
        while(j&lt;i){
            if(primes[j]&lt;=q &amp;&amp; s%primes[j]==0){
                s+=k
                k=(k+k)%6
                q = (int) Math.ceil(Math.sqrt(s))
                j = 0
            }else{
                j++;
            }
        }
        primes.add(s)
        s+=k
        k = (k+k)%6
        q = (int) Math.ceil(Math.sqrt(s))
    }
}
t = System.currentTimeMillis()
buildPrimeTable(10000)
println System.currentTimeMillis() - t
println primes[10000]
</code></pre>
<p>以生成前10000位素数为例，结果如下：
Java:718ms，表现不错。
Python:8833ms，8秒，java的10倍，也可能是我代码写的不好。
Groovy:77484ms，没错，你没看错是5位数，77秒！几乎是java版的110倍。天啊，这也忒慢了吧，是不是我触犯了什么禁忌啊，很可能出现在列表结构上面，下次再弄清楚啦。</p>

<div class="footer">
  <ul class="tag_box inline">
  <li><a href="/moon-2013/tags#Groovy-ref">Groovy</a></li>
  <li><a href="/moon-2013/tags#Java-ref">Java</a></li>
  <li><a href="/moon-2013/tags#闭包-ref">闭包</a></li>
  </ul>
  <span class="date">
  2010-12-30
  </span>
</div>
</article>


<div class="box">
  <div class="plus">
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
<g:plusone></g:plusone>
    <!-- JiaThis Button BEGIN -->
<div class="jiathis_style"><span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_qzone"></a>
<a class="jiathis_button_tsina"></a>
<a class="jiathis_button_tqq"></a>
<a class="jiathis_button_renren"></a>
<a class="jiathis_button_kaixin001"></a>
<a href="http://www.jiathis.com/share?uid=1677096" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
var jiathis_config={
	data_track_clickback:true,
	hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1677096" charset="utf-8"></script>
<!-- JiaThis Button END -->
	

  </div>
    <div id="disqus_thread"></div>
<script type="text/javascript">
	var disqus_developer = 1;
	var disqus_title = 'Groovy初接触';

	var disqus_identifier ='446 http://dourok.info/?p=446';

	var disqus_shortname = 'doousblog';
	
	var disqus_url = 'https://douo.github.io/moon-2013/2010/12/30/groovy-introduce';
	
	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>

<noscript>
	Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
<!-- disqus end-->

 </div>

	      </div>  <!-- content -->
      </div>  <!-- row -->
      <div class="row-fluid">
	<div class="span2 hidden-phone"></div>
	<div class="span8">
	  <footer class="statement">
	    <small class＝"copyright">&copy;2009-2013  |</small>
	    <small class= "power">基於 <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a>
	      和 <a href="http://twitter.github.com/bootstrap/"
	  	  target="_blank">Twitter Bootstrap</a> <a href="/diary"><img src="/moon-2013/assets/media/broken_heart.png"></img></a></small>
	    <small class="license">
	      <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh"><img title="知识共享许可协议" style="border-width: 0px; vertical-align: middle; display: inline; " src="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" original="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png"></a>		
	    </small>
	  </footer>
	  
	      </div>
      </div>
	
	
<script type="text/javascript">
   $(function(){
   $(window).scroll(function(){  //只要窗口滚动,就触发下面代码 
   var scrollt = document.documentElement.scrollTop + document.body.scrollTop; //获取滚动后的高度 
   if( scrollt >200 ){  //判断滚动后高度超过200px,就显示  
	$("#gotop").fadeIn(400); //淡出     
	}else{      
	$("#gotop").stop().fadeOut(400); //如果返回或者没有超过,就淡入.必须加上stop()停止之前动画,否则会出现闪动   
	}
	});
	$("#gotop").click(function(){ //当点击标签的时候,使用animate在200毫秒的时间内,滚到顶部
	$("html,body").animate({scrollTop:"0px"},200);
	});
	});
</script>
<a id="gotop" href="#">   
	<span>▲</span> 
</a>
    </div> <!-- /container -->
    
    <!-- Google Prettify -->
<script src="http://cdn.staticfile.org/prettify/r298/prettify.min.js"></script>
<script>
  var pres = document.getElementsByTagName("pre");
  for (var i=0; i < pres.length; ++i) {
    pres[i].className = "prettyprint linenums";
  }
  prettyPrint();
</script>
<!-- end Google Prettify -->
  </body>

</html>
