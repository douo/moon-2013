<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>
      Java ME通用Logger包和控制台 | 
      DouO's Blog
    </title>
    <meta name="author" content="DouO">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
    
    <!-- Le styles -->
<link href='/moon-2013/assets/stylesheets/bootstrap.min-93b47f97c3444c4711853ed5140d82a1.css' type='text/css' rel='stylesheet' media='all'>
<link href='/moon-2013/assets/stylesheets/bootstrap-responsive.min-6be942c8ec424a44aa4f31e099bae1fc.css' type='text/css' rel='stylesheet' media='all'>
<link href='/moon-2013/assets/stylesheets/toc-24de7073de5e84bbdf82d581655967fa.css' type='text/css' rel='stylesheet' media='all'>
<link href='/moon-2013/assets/stylesheets/style-2a78e0c366d18704c93f8db7772659c6.css' type='text/css' rel='stylesheet' media='all'>
<link href='/moon-2013/assets/stylesheets/widgets/google_prettify/moon-a586c0c53856bb03a2050ca5121629fe.css' type='text/css' rel='stylesheet' media='all'>    

    <!-- script -->
<script src='/moon-2013/assets/javascripts/jquery-1.8.2.min-cfa9051cc0b05eb519f1e16b2a6645d7.js'></script>
<script src='/moon-2013/assets/javascripts/bootstrap.min-240e44e4195f0836ced0eab636f9cb0c.js'></script>
<script src='/moon-2013/assets/javascripts/front-9bcae9460ba6dd25c936b7bdc47a9998.js'></script>
<script src='/moon-2013/assets/javascripts/jquery.c.min-e08fd6c1881afcf509255ce8b8f9b32b.js'></script>
<script src='/moon-2013/assets/javascripts/jquery.smooth-scroll.min-5caac1be39aee89977e39f82d14f0e08.js'></script>    
    
	

<script src="/moon-2013/assets/widgets/lazyload/javascripts/jquery.lazyload.min.js"></script>
    <!-- lazyload -->
    <script type="text/javascript">
      jQuery(document).ready(function($){
      if (navigator.platform == "iPad") return;
      jQuery("img.lazy").not(".cycle img").lazyload({
      effect:"fadeIn",
      placeholder: "/moon-2013/assets/media/ajax-loader.gif"
      });
      });
    </script>
   

    
<!-- Add mousewheel plugin (this is optional) -->
<script type="text/javascript" src="//cdn.staticfile.org/jquery-mousewheel/3.1.3/jquery.mousewheel.min.js"></script>


<!-- Add fancyBox -->
<link rel="stylesheet" href="/moon-2013/assets/widgets/fancybox/stylesheets/jquery.fancybox.css" type="text/css" media="screen" />
<script src="/moon-2013/assets/widgets/fancybox/javascripts/jquery.fancybox.pack.js"></script>

<!-- Optionally add helpers - button, thumbnail and/or media -->

<!-- <link rel="stylesheet" href="/fancybox/source/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen" />
<script type="text/javascript" src="/fancybox/source/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="/fancybox/source/helpers/jquery.fancybox-media.js?v=1.0.6"></script>

<link rel="stylesheet" href="/fancybox/source/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen" />
<script type="text/javascript" src="/fancybox/source/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script> -->


<script type="text/javascript">
      $(document).ready(function() {
      $(".fancybox").fancybox();
      });
    </script>
   


    <link rel="shortcut icon" href="/moon-2013/assets/media/favicon.ico">
    <!-- Le fav and touch icons -->
    <!-- Update these with your own images
	 <link rel="shortcut icon" href="images/favicon.ico">
	 <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	 <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	 <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	 -->
    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12243999-3']);
  _gaq.push(['_trackPageview']);
  

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


    <!-- processing -->
    
<script type="text/javascript"
  src="http://cdn.staticfile.org/processing.js/1.4.1/processing.min.js">
</script>

  </head>
  <body>
    <div class="container">
      <div class="row-fluid">
	<div class="span2 hidden-phone"></div>
	<div class="span8">
	  <header class="header pull-left">
	    <h1>Java ME通用Logger包和控制台</h1>
	  </header>
  	  <button type="button" class="btn btn-navbar pull-right" data-toggle="collapse" data-target=".nav-collapse">
	    <span class="icon-bar"></span>
	    <span class="icon-bar"></span>
	    <span class="icon-bar"></span>
	    </button>
	</div> <!-- header -->

         </div>
      <div class="row-fluid">
	<div class="span2 hidden-phone"></div>
	<div class="span8 content">
	  <div class="nav-wrapper nav-collapse collapse"   data-spy="affix" data-offset-top="70" >
	    <nav class="nav moon-nav-list">
	      <ul>
	        <li><a href="/" rel="tooltip" data-placement="top" title="主頁">home</a></li>
	        <li><a href="/moon-2013/archives" rel="tooltip" data-placement="top" title="文章歸檔">archives</a></li>
	        <li><a href="/moon-2013/notes" rel="tooltip" data-placement="top" title="我的個人筆記">notes</a></li>
	        <li><a href="/moon-2013/rss.xml" rel="tooltip" data-placement="top" title="訂閱">feed</a></li>
	        <li><a href="/moon-2013/about" rel="tooltip" data-placement="top" title="關於我">about</a></li>
	        <li  class="separate"></li>
	        <li> 
	  	<a class="meta-nav next" href="/moon-2013/2010/05/22/netbeans-as-android-ide">
	  	  <span>←<br></span>在Netbeans上配置Android开发环境
	  	</a>
	        </li>
	        <li>
	  	<a class="meta-nav previous" href="/moon-2013/2010/04/22/j2me-jsr-75">
	  	  Java Me读取本地文件(JSR 75)<span><br>→</span>
	  	</a>
	        </li>
	      </ul>
	    </nav>
	  </div>
	  
	      <article class="post box">
<ul class="category-label">
<li><a href="/moon-2013/categories#coder-ref" class="coder">coder</a></li>
</ul>
<div class="cf"></div>
<div class="cf"></div><div id="toc_container" class="toc_wrap_right toc_black no_bullets" ><p class="toc_title">目录</p><ul class="toc_list">
     <li><a href="#toc_0">写在前面</a>
     <ul>
     </ul>
     </li>
     
     <li><a href="#toc_1">正文</a>
     <ul>
     </ul>
     </li>
     
     <li><a href="#toc_2">最后</a>
     <ul>
     </ul>
     </li>
     
     <li><a href="#toc_3"><a href="%7B%7Burls.media%7D%7D/wp-content/uploads/2010/05/console-e1274319179862-225x300.png"><img src="%7B%7Burls.media%7D%7D/wp-content/uploads/2010/05/console-e1274319179862-225x300.png" alt="" title="console"></a></a>
     <ul>
     </ul>
     </li>
     
     <li><a href="#toc_4"><a href="%7B%7Burls.media%7D%7D/wp-content/uploads/2010/05/console-e1274319179862-225x300.png"><img src="%7B%7Burls.media%7D%7D/wp-content/uploads/2010/05/console-e1274319179862-225x300.png" alt="" title="console"></a></a>
     <ul>
     </ul>
     </li>
     
</div>


<h2 id="toc_0">写在前面</h2>
<p>这是一个JavaMe的通用轻量级Logger系统和控制台程序，轻击<a href="#source" title="">这里下载logger源码</a>，把它拉到你的项目里面去便可，要看下例子可以再轻击<a href="#example" title="">这里</a>，还有<a href="#image" title="">效果图在这</a>。</p>
<h2 id="toc_1">正文</h2>
<p>OK，正文了。我写Java
Me程序的时候很多次程序都是自我感觉良好在模拟器上跑起来也没问题，但一到真机就卡壳了。而且，在真机上跑又不像在电脑上开发一样有个控制台可以打印信息，有时要在真机上获得一系列错误信息那是相当麻烦。我曾经试过，调用InputStream的read(byte[]b,int
offset,int len)方法,居然可以最后一字节没被读出来；用new String(byte[] b ,
&quot;gb2312&quot;)来转换编码时，居然最后一个字节会丢失；还有用Connector来得到FileConnection时，如果将模式设置为「只读」直接程序崩溃，等等，好多。真是苦不堪言。恩，好吧，我承认我的机器是MTK系统滴。如果说ME程序员是IT民工中的搬运工，那么给MTK写ME程序的就是那枚扮演烈日下搬砖头的角色。所以说如果能有一个通用的控制台程序那就显得相当有用了，简直就是给ME程序员穿上滑轮鞋。</p>

<p>恰好，近日在看Fire2<a href="#fire2" title="">^[1]^</a>时，里面刚好有个控制台，还有个日志系统。不过Fire2的控制台是基于它自己的UI控件的，不具备通用性，而且效率不行，打印信息一多严重拖慢系统程序。于是我自己用Canvas重新实现了控制台，并将Fire2中的日志系统提取出来做了点修改，跟我的控制台打包成一通用的日志系统logger包。</p>

<p>该日志系统有三个类一个接口组成。</p>

<ul>
<li>  <a href="#Log" title="">Log</a></li>
<li>  <a href="#Logger" title="">Logger</a></li>
<li>  <a href="#Console" title="">Console</a></li>
<li>  <a href="#ConsolePainter" title="">ConsolePainter</a></li>
</ul>

<p>Log是在Fire2里实现好的，有一系列的静态方法，包括添加和设置Logger，还有一系列记录消息的方法，Log里面的消息四个级别，分别为Info、Warn、ERROR、Debug。Log对象默认实现一个Logger，这个默认的Logger就是将消息打印在控制台(System.out.println())。</p>

<p>Logger 是一个接口只有一个方法</p>
<pre><code class="java">public void println(String txt , int level);
</code></pre>
<p>要自己实现logger只需实现这个接口便可，比如说把Log消息写文件里面去，发送到服务器等等。</p>

<p>Console就是控制台，是一个独立的全屏的界面，继承了Canvas，实现了Logger接口。将Log记录下来的消息绘制到屏幕上。考虑到一个Midlet只需要一控制台，又必须给Console传入Display参数，所以便按单例模式实现Console。</p>

<p>得到Console实例的方法有两个，getConsole(Display) 和getConsole()</p>

<p>但要注意一点，第一次得到Console对象时，必须先使用getConsole(Display)，来为其传入Display对象。</p>

<p>显示Console只需调用showConsole(Displayable
screen)，传入的Displayable为调用显示控制台是的当前界面，从Console返回时会自动显示该界面。screen可以为null，当screen为null时Console无法返回。</p>

<p>一个使用控制台的例程可以像这样</p>
<pre><code class="java">Display dis = Display.getDisplay(this);
Console console = Console.getConsole(dis);
Log.showDebug = true;
Log.addLogDestination(console);
Log.logInfo(&quot;console already&quot;);
Log.logDebug(Console.getMemoryInfo());
try{
//一些可能抛出异常的操作
}catch(Exception e){
Log.logError(&quot;ERROR&quot; , e);
console.showConsole(null);
}
</code></pre>
<p>Console还有个String getMemoryInfo()的方法，来得到当前虚拟机的内存信息。</p>

<p>ConsolePainter
是控制台画笔,负责把字符串绘制到屏幕上，ConsolePainter绘制字符串暂时还可以接受的，主要因为绘制的时候只有当前屏幕会显示到的字符串才会被绘制，具体留意下setTransition()。Console便是使用该类来绘制信息，同样的ConsolePainter实现了Logger接口，所以，也可直接在你的Canvas使用该画笔，来把Log消息直接绘制在Canvas上。</p>

<p>再来看下ConsolePainter的构造函数ConsolePainter(Canvas canvas, boolean
autoclean)，canvas为需要绘制画笔，ConsolePainter要获得Canvas的大小来布局字符串，绘制的时候需要在Canvas调用ConsolePainter.paint(Graphics
g)。很多时候消息太多会超过一屏，要在canvas实现滚屏那显的没必要。将autoclean设置为true，当消息超过一屏时，旧的消息会被移除，以保证新消息可以显示在屏幕中。</p>
<h2 id="toc_2">最后</h2>
<p>先来看下效果图先。这可是MTK真机上截的图哦。</p>
<h2 id="toc_3"><a class="fancybox" rel="group" href="/moon-2013/assets/media/wp-content/uploads/2010/05/console-e1274319179862-225x300.png" title=""><img class="lazy img-polaroid display" src="/moon-2013/assets/media/wp-content/uploads/2010/05/console-e1274319179862-225x300.png" title="console"  alt=""></a></h2>
<p>现在Console的问题应该是多多的，可定制性几乎没有。不过我目前用起来挺顺手的，以后还会一直用它，发现问题到时再来改吧。</p>

<p><a href="http://dourok.info/wp-content/uploads/2010/05/logger.zip" title="">源码下载</a></p>

<p>[1].Fire2 是一款轻量级的J2ME
UI库，可自定义主题，同时支持渲染xHtml/CSS，提供有xHtml浏览器组件。<a href="http://sourceforge.net/projects/fire-j2me/" title="">这里</a>是它的项目地址</p>
<h2 id="toc_4"><a class="fancybox" rel="group" href="/moon-2013/assets/media/wp-content/uploads/2010/05/console-e1274319179862-225x300.png" title=""><img class="lazy img-polaroid display" src="/moon-2013/assets/media/wp-content/uploads/2010/05/console-e1274319179862-225x300.png" title="console"  alt=""></a></h2>
<div class="footer">
  <ul class="tag_box inline">
  <li><a href="/moon-2013/tags#J2ME-ref">J2ME</a></li>
  <li><a href="/moon-2013/tags#控制台-ref">控制台</a></li>
  </ul>
  <span class="date">
  2010-05-15
  </span>
</div>
</article>


<div class="box">
  <div class="plus">
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
<g:plusone></g:plusone>
    <!-- JiaThis Button BEGIN -->
<div class="jiathis_style"><span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_qzone"></a>
<a class="jiathis_button_tsina"></a>
<a class="jiathis_button_tqq"></a>
<a class="jiathis_button_renren"></a>
<a class="jiathis_button_kaixin001"></a>
<a href="http://www.jiathis.com/share?uid=1677096" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
var jiathis_config={
	data_track_clickback:true,
	hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1677096" charset="utf-8"></script>
<!-- JiaThis Button END -->
	

  </div>
    <div id="disqus_thread"></div>
<script type="text/javascript">
	var disqus_developer = 1;
	var disqus_title = 'Java ME通用Logger包和控制台';

	var disqus_identifier ='22 http://dourok.info/2010/05/%e4%b8%80%e4%b8%aame%e7%9a%84log%e5%8c%85/';

	var disqus_shortname = 'doousblog';
	
	var disqus_url = 'https://douo.github.io/moon-2013/2010/05/15/a-logger-for-j2me';
	
	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>

<noscript>
	Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
<!-- disqus end-->

 </div>

	      </div>  <!-- content -->
      </div>  <!-- row -->
      <div class="row-fluid">
	<div class="span2 hidden-phone"></div>
	<div class="span8">
	  <footer class="statement">
	    <small class＝"copyright">&copy;2009-2013  |</small>
	    <small class= "power">基於 <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a>
	      和 <a href="http://twitter.github.com/bootstrap/"
	  	  target="_blank">Twitter Bootstrap</a> <a href="/diary"><img src="/moon-2013/assets/media/broken_heart.png"></img></a></small>
	    <small class="license">
	      <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh"><img title="知识共享许可协议" style="border-width: 0px; vertical-align: middle; display: inline; " src="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" original="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png"></a>		
	    </small>
	  </footer>
	  
	      </div>
      </div>
	
	
<script type="text/javascript">
   $(function(){
   $(window).scroll(function(){  //只要窗口滚动,就触发下面代码 
   var scrollt = document.documentElement.scrollTop + document.body.scrollTop; //获取滚动后的高度 
   if( scrollt >200 ){  //判断滚动后高度超过200px,就显示  
	$("#gotop").fadeIn(400); //淡出     
	}else{      
	$("#gotop").stop().fadeOut(400); //如果返回或者没有超过,就淡入.必须加上stop()停止之前动画,否则会出现闪动   
	}
	});
	$("#gotop").click(function(){ //当点击标签的时候,使用animate在200毫秒的时间内,滚到顶部
	$("html,body").animate({scrollTop:"0px"},200);
	});
	});
</script>
<a id="gotop" href="#">   
	<span>▲</span> 
</a>
    </div> <!-- /container -->
    
    <!-- Google Prettify -->
<script src="http://cdn.staticfile.org/prettify/r298/prettify.min.js"></script>
<script>
  var pres = document.getElementsByTagName("pre");
  for (var i=0; i < pres.length; ++i) {
    pres[i].className = "prettyprint linenums";
  }
  prettyPrint();
</script>
<!-- end Google Prettify -->
  </body>

</html>
